{% extends "layout.html" %}
{% block body %}
    <div class="btn-group pull-right">
        <button class="btn dropdown-toggle" data-toggle="dropdown">
            {{ number_of_lines }}
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li><a href="{{ current_url(number_of_lines=10) }}">10</a></li>
            <li><a href="{{ current_url(number_of_lines=25) }}">25</a></li>
            <li><a href="{{ current_url(number_of_lines=50) }}">50</a></li>
        </ul>
    </div>
    <table class="table appstats-table table-bordered table-striped table-condensed">
        <thead>
            <tr>
                {% if sort_by_field == 'name' %}
                    <th> NAME </th>
                {% else %}
                    <th> <a href="{{ url_for(request.endpoint, sort_by_field='name',
                                             sort_by_period='hour',
                                             number_of_lines=number_of_lines,
                                             selected_field=selected_field) }}">
                            NAME
                        </a>
                    </th>
                {% endif %}
                {% for field in fields %}
                    {% if field['key'] == selected_field %}
                        <th COLSPAN="4"> {{ field['name'] }} </th>
                    {% else %}
                        <th><a href="{{ url_for(request.endpoint, app_id=app_id,
                                                sort_by_field=sort_by_field,
                                                sort_by_period=sort_by_period,
                                                number_of_lines=number_of_lines,
                                                selected_field=field['key']) }}">
                                {{ field['name'] }}
                            </a>
                        </th>
                    {% endif %}
                {% endfor %}
            </tr>
        </thead>
            <tbody>
                <tr>
                    <td></td>
                    {% for field in fields %}
                        {% if field['key'] == sort_by_field and sort_by_period == 'hour_aver' %}
                                <td> Avg(1h) </td>
                            {% else %}
                                <td><a href="{{ url_for(request.endpoint, app_id=app_id,
                                                        sort_by_field=field['key'],
                                                        sort_by_period='hour_aver',
                                                        number_of_lines=number_of_lines,
                                                        selected_field=selected_field) }}">
                                        Avg(1h)
                                    </a>
                                </td>
                            {% endif %}

                            {% if field['key'] == selected_field %}
                                {% if field['key'] == sort_by_field and sort_by_period == 'day_aver' %}
                                    <td> Avg(24h) </td>
                                {% else %}
                                    <td><a href="{{ url_for(request.endpoint, app_id=app_id,
                                                            sort_by_field=field['key'],
                                                            sort_by_period='day_aver',
                                                            number_of_lines=number_of_lines,
                                                            selected_field=selected_field) }}">
                                            Avg(24h)
                                        </a>
                                    </td>
                                {% endif %}

                                {% if field['key'] == sort_by_field and sort_by_period == 'hour' %}
                                    <td> 1h </td>
                                {% else %}
                                    <td><a href="{{ url_for(request.endpoint, app_id=app_id,
                                                            sort_by_field=field['key'],
                                                            sort_by_period='hour',
                                                            number_of_lines=number_of_lines,
                                                            selected_field=selected_field) }}">
                                            1h
                                        </a>
                                    </td>
                                {% endif %}

                                {% if field['key'] == sort_by_field and sort_by_period == 'day' %}
                                    <td> 24h </td>
                                {% else %}
                                    <td><a href="{{ url_for(request.endpoint, app_id=app_id,
                                                            sort_by_field=field['key'],
                                                            sort_by_period='day',
                                                            number_of_lines=number_of_lines,
                                                            selected_field=selected_field) }}">
                                            24h
                                        </a>
                                    </td>
                                {% endif %}
                            {% endif %}
                    {% endfor %}
                </tr>
                {% for doc in docs %}
                    <tr>
                        <td colspan="{{ fields|length + 4 }}">
                            <a href="{{ url_for('info_page', name=doc['name'], app_id=app_id) }}"> {{ doc['name'] }} </a>
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        {% for field in fields %}
                            {% if field['format'] == 'time' %}
                                <td> {{ doc.setdefault('%s_%s' % (field['key'], 'hour_aver'), 0.0) | time }} </td>
                                {% if field['key'] == selected_field %}
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'day_aver'), 0.0) | time }} </td>
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'hour'), 0.0) | time }} </td>
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'day'), 0.0) | time }} </td>
                                {% endif %}
                            {% elif field['format'] == 'filesize' %}
                                <td> {{ doc.setdefault('%s_%s' % (field['key'], 'hour_aver'), 0.0) | filesizeformat }} </td>
                                {% if field['key'] == selected_field %}
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'day_aver'), 0.0) | filesizeformat }} </td>
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'hour'), 0.0) | filesizeformat }} </td>
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'day'), 0.0) | filesizeformat }} </td>
                                {% endif %}
                            {% elif field['format'] == 'count' %}
                                <td> {{ doc.setdefault('%s_%s' % (field['key'], 'hour_aver'), 0.0) | count }} </td>
                                {% if field['key'] == selected_field %}
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'day_aver'), 0.0) | count }} </td>
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'hour'), 0.0) | count }} </td>
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'day'), 0.0) | count }} </td>
                                {% endif %}
                            {% else %}
                                <td> {{ doc.setdefault('%s_%s' % (field['key'], 'hour_aver'), 0.0) }} </td>
                                {% if field['key'] == selected_field %}
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'day_aver'), 0.0) }} </td>
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'hour'), 0.0) }} </td>
                                    <td> {{ doc.setdefault('%s_%s' % (field['key'], 'day'), 0.0) }} </td>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
    </table>
    <script src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>
{% endblock %}
