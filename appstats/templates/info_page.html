{% extends "layout.html" %}
{% block body %}
    <script src="{{ url_for('static', filename='js/jquery-1.7.2.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/highcharts.js') }}"></script>
    <form>
        <span name="hours_radio" class="btn-group" data-toggle="buttons-radio" onclick="_submit()">
            <button name="hours" value="6" class="btn {{ 'active' if hours == 6 else ''}}">6 hours</button>
            <button name="hours" value="12" class="btn {{ 'active' if hours == 12 else ''}}">12 hours</button>
            <button name="hours" value="24" class="btn {{ 'active' if hours == 24 else ''}}">1 day</button>
            <button name="hours" value="144" class="btn {{ 'active' if hours == 144 else ''}}">6 days</button>
            <button name="hours" value="720" class="btn {{ 'active' if hours == 720 else ''}}">30 days</button>
        </span>
    </form>
    <div style="height: 300px;" id="num_graph"></div>
    <div style="height: 300px;" id="time_graph"></div>

    <script>
        function _submit() {
            hours = $('button[name="hours"].active').val();
            document.location.href="{{ url_for(request.endpoint, app_id=app_id, name=name)}}" +
            '?' + $.param([
                {name : 'hours', value : hours}
            ])
        }

        function draw_graph(table, names, container_id, title) {
            var chart;
            var data = []

            data.push({
                name: names[0],
                data: table[0]
            })
            for (var i=1; i < table.length; i++) {
                data.push(
                {
                    stacking: 'normal',
                    name: names[i],
                    data: table[i]
                }
                )
            }

            Highcharts.setOptions({
                global: {
                    useUTC: false
                }
            });

            chart = new Highcharts.Chart({
                chart: {
                    renderTo: container_id,
                    type: 'area',
                    spacingRight: 20
                },
                title: {
                    text: title
                },
                xAxis: {
                    type: 'datetime',
                    title: {
                        text: null
                    }
                },
                yAxis: {
                    title: {
                        text: null
                    },
                    min: 0.6,
                    startOnTick: false,
                    showFirstLabel: false
                },
                legend: {
                    enabled: true
                },
                plotOptions: {
                    area: {
                        fillOpacity: 1,
                        lineWidth: 1,
                        marker: {
                            enabled: false,
                        },
                        enableMouseTracking: false,
                        shadow: false,
                    },
                    series: {
                        animation: false,
                    },
                },

                series: data,
            });
            
        };

        draw_graph({{ num_data|json }}, {{ ['NUMBER / sec']|safe }}, 'num_graph', '{{ name }}');
        draw_graph({{ time_data|json }}, {{ time_labels|safe }}, 'time_graph', '{{ name }}');
    </script>
{% endblock %}
