{% macro draw_table(data, fields, sort_by_field, sort_by_period) -%}
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th> <a href="{{ url_for('main_page', sort_by_field='NAME', sort_by_period='hour') }}"> NAME </a> </th>
                <th> <a href="{{ url_for('main_page', sort_by_field='REQUESTS', sort_by_period='hour') }}"> REQUESTS </a> </th>
                {% for field in fields %}
                    {%if field != "REQUESTS" %}
                        <th COLSPAN=3> {{ field }} </th>
                    {% endif %}
                {% endfor %}
            </tr>
        </thead>
            <tr>
                <td> </td>
                <td> </td>
                {% for field in fields %}
                    {%if field != "REQUESTS" %}
                        {% if field == sort_by_field and sort_by_period == 'hour' %}
                            <td> H </td>
                        {% else %}
                            <td> <a href="{{ url_for('main_page', sort_by_field=field, sort_by_period='hour') }}"> H </a> </td>
                        {% endif %}
                        {% if field == sort_by_field and sort_by_period == 'hour_aver' %}
                            <td> &ltH&gt </td>
                        {% else %}
                            <td> <a href="{{ url_for('main_page', sort_by_field=field, sort_by_period='hour_aver') }}"> &ltH&gt </a> </td>
                        {% endif %}
                        {% if field == sort_by_field and sort_by_period == 'day_aver' %}
                            <td> &ltD&gt </td>
                        {% else %}
                            <td> <a href="{{ url_for('main_page', sort_by_field=field, sort_by_period='day_aver') }}"> &ltD&gt </a> </td>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </tr>
            <tbody>
                {% for row in data %}
                    <tr>
                        <td> {{ row['hour']['NAME'] }} </td>     
                        <td> {{ row['hour']['REQUESTS'] }} </td>     
                        {% for field in fields %}
                            {%if field != "REQUESTS" %}
                                <td> {{ row['hour'][field] }} </td>     
                                <td> {{ row['hour_aver'][field] }} </td>     
                                <td> {{ row['day_aver'][field] }} </td>     
                            {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
    </table>
{%- endmacro %}
